
Last login: Wed Nov 19 13:06:46 2025 from 198.211.111.194
root@ubuntu-s-1vcpu-1gb-amd-atl1-01:~# # Test 1: Verify allowlist-check endpoint works
curl http://localhost:3001/allowlist-check?domain=insurance-999.com
echo ""

# Test 2: Try HTTPS (this will trigger Caddy to request a certificate)
echo "Testing HTTPS - this may take 10-15 seconds for certificate issuance..."
curl -I https://insurance-999.com

# Test 3: Check Caddy logs for certificate activity
echo ""
echo "=== Caddy Logs (last 30 lines) ==="
sudo journalctl -u caddy -n 30 --no-pager
Domain not in allowlist
Testing HTTPS - this may take 10-15 seconds for certificate issuance...
curl: (35) error:0A000438:SSL routines::tlsv1 alert internal error

=== Caddy Logs (last 30 lines) ===
Nov 19 13:14:46 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558086.9748476,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:14:46 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558086.9985895,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:14:57 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558097.7408533,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:14:57 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558097.7765613,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:09 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558109.3543332,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"landingpagesforagentsfallback.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'landingpagesforagentsfallback.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=landingpagesforagentsfallback.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:22 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558122.4081113,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"landingpagesforagentsfallback.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'landingpagesforagentsfallback.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=landingpagesforagentsfallback.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:23 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558123.1538427,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:23 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558123.155077,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:33 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558133.993873,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:34 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558134.0736213,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:45 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558145.244494,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:45 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558145.2523847,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:56 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558156.0303812,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:15:56 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558156.0664911,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:06 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558166.8684325,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:06 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558166.8695734,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:34 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558194.1081078,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:34 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558194.110544,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:44 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558204.8965104,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:44 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558204.9019623,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:55 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558215.9380865,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:16:55 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558215.9390903,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:07 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558227.2710009,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:07 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558227.2720916,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:18 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558238.664348,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:18 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558238.756357,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:29 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558249.911437,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:29 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558249.922079,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:40 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558260.7548714,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"insuranceoninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'insuranceoninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=insuranceoninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}
Nov 19 13:17:40 ubuntu-s-1vcpu-1gb-amd-atl1-01 caddy[705]: {"level":"error","ts":1763558260.7574756,"logger":"tls","msg":"failed to get permission for on-demand certificate","domain":"vanhaleninsurance.com","error":"checking http://localhost:3001/allowlist-check to determine if certificate for hostname 'vanhaleninsurance.com' should be allowed: Get \"http://localhost:3001/allowlist-check?domain=vanhaleninsurance.com\": dial tcp [::1]:3001: connect: connection refused"}